name: ARMbuild

on: [push, pull_request]

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        config:
          - os: "ubuntu-latest"
            cxx-compiler: g++-8
            c-compiler: gcc-8
            build-type: RelWithDebInfo
    runs-on: ${{ matrix.config.os }}

    steps:
      - uses: actions/checkout@v1
      - uses: uraimo/run-on-arch-action@v1.0.5
        id: runcmd
        with:
          architecture: armv6
          distribution: buster
          run: |
            uname -a
            sudo apt-get update
            sudo apt install -y build-essential

            sudo apt-get install "$cxx-compiler" -y
            echo "$cxx-compiler --version"
            sudo apt-get install cmake mysql-client libmysqlclient-dev -y

            export CXX=$cxx-ompiler
            export CC=$c-compiler
      
            cd bin-build
            cmake ..
            cmake --build . --config ${{ matrix.config.build-type }} -- -j 2
            ctest -j2 --output-on-failure --repeat-until-fail 2 -C ${{ matrix.config.build-type }}
